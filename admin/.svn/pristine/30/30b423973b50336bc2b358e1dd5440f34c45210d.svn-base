<template>
    <div class='navBarContainer'>
        <span class='transformIcon' @click='tranformCollapse' :style='transformIconStyle'></span>
        <div class='navBarRoute'>
            <router-link to="/">主页</router-link>
            <span to="/">{{routeAlias[0] ? "/" + routeAlias[0] : ""}}</span>
            <span to="/">{{routeAlias[1] ? "/" + routeAlias[1] : ""}}</span>
            <span to="/">{{routeAlias[2] ? "/" + routeAlias[2] : ""}}</span>
        </div>
        <div class='navBarTabTag'>
            <template v-for='routeItem in navBarTabTag'>
                <el-tag :type='routeItem.clicked ? "primary" : "" ' :closable="true" @close="tabTagIsClosed(routeItem)" @click='tabTagIsClicked(routeItem)' :key='routeItem.routeName'>{{routeItem.alias}}</el-tag>
            </template>
        </div>
    </div>
</template>

<script>
import { mapState, mapMutations } from 'vuex'
import { routerData } from '../../router'

export default {
    name: 'NavBar',
    data() {
        return {
            transformIconStyle: {
                transform: 'rotate(90deg)' // 控制图标转换的样式
            },
            routeAlias: ['']
        }
    },
    computed: mapState([
        'sideBarIsCollapse',
        'navBarTabTag'
    ]),
    methods: {
        ...mapMutations([
            'changeCollapseStatus',
            'deleteNavBarTabTag',
            'changeTabTagClickedStatus'
        ]),
        tranformCollapse() {
            // 转换90°动画
            if (this.sideBarIsCollapse) {
                this.transformIconStyle.transform = 'rotate(90deg)'
            } else {
                this.transformIconStyle.transform = 'rotate(0deg)'
            }
            // 改变侧栏展开状态
            this.changeCollapseStatus()
        },
        computeRouteName(route) {
            // 计算出当前路径所对应的各级路由的别名

            const routeArray = route.path.replace(/^\/|\/$/g, '').split('/')
            const routeNameArray = [];

            // 如果是主页,返回空
            if (routeArray.length === 1 && routeArray[0] === '') {
                return ['']
            }
            // 遍历 寻找路由配置alias.
            let regex = new RegExp(routeArray[0])
            routerData.forEach(levelOne => {
                // 如果找到第一个路由名称
                if (regex.test(levelOne.path)) {
                    routeNameArray.push(levelOne.alias)
                    // 如果存在第二个路由信息,继续
                    if (routeArray.length >= 2) {
                        regex = new RegExp(routeArray[1])
                        levelOne.children.forEach(levelTwo => {
                            // 找到第二个名称
                            if (regex.test(levelTwo.path)) {
                                routeNameArray.push(levelTwo.alias)
                                // 如果总共存在三级路由
                                if (routeArray.length === 3) {
                                    regex = new RegExp(routeArray[2])
                                    levelTwo.children.forEach(levelThree => {
                                        // 找到第三个路由
                                        if (regex.test(levelThree.path)) {
                                            routeNameArray.push(levelThree.alias)
                                        }
                                    })
                                }
                            }
                        })
                    }
                }
            })
            return routeNameArray
        },
        tabTagIsClosed(TagItem) {
            // Tab标签被关闭
            // 从数据源中移除它
            this.deleteNavBarTabTag(TagItem)
        },
        tabTagIsClicked(tagItem) {
            // Tab标签被点击
            // 改变数据源中该标签数据的clicked属性
            this.changeTabTagClickedStatus(tagItem)
        }
    },
    watch: {
        $route(val) {
            const routeArray = this.computeRouteName(val)
            this.routeAlias = routeArray
            // routeArray.forEach((item) => {
            // })
        }
    }

}
</script>

<style scoped>
.navBarContainer {
    background: #eef1f6;
    height: 50px;
    display: flex;
    align-items: center;
}

.transformIcon {
    background: url('~images/threeline.png');
    display: inline-block;
    width: 25px;
    height: 25px;
    background-size: cover;
    background-repeat: no-repeat;
    -webkit-transition: transform 1s;
    -moz-transition: transform 1s;
    transition: transform 0.28s;
    margin: 10px;
}

.navBarRoute a {
    color: #333;
    text-decoration: none;
}

.navBarRoute span {
    color: black;
}

.navBarTabTag {
    margin-left: 3rem;
}

.navBarTabTag>span {
    margin: 0 0.2rem;
}
</style>
